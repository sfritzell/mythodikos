<!-- 
This is html for displaying the Mythodikos webmap
Adapted from MOLeaflet.html

NEXT STEPS:
1. define popup for search results
2. set search for multiple results (may require new function)
(3. consider marker clusters)
-->

<!DOCTYPE html>
<html lang="en-US">

<html>

<head>

	<title>Mythodikos</title>

	<!--the meta element disables unwanted scaling of the page when viewed on mobile devices-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<!--this is a reference to the Leaflet CSS file; CSS files must be called before JavaScript links-->
	<link
	rel="stylesheet" 
	href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
	integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
	crossorigin=""
	/>

	<!--this is a reference to the easybutton CSS file-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">

	<!--this is a link to use google icons-->
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

	<!--this is a link to the search control css-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-search@2.9.8/src/leaflet-search.min.css">
	
	<!--this is a link to the jquery css-->
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"> 

	<!--this is a refence to the Leaflet JavaScript file; it must be included after the CSS-->
	<script
	src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
	integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
	crossorigin=""
	></script>

	<!--these are references to jquery-->
	<script
	src="https://code.jquery.com/jquery-3.6.0.js"
	integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
	crossorigin="anonymous">
	</script>
	<script 
	src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" 
	integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30=" 
	crossorigin="anonymous">
		
	</script>

	<!--this is a reference to the easybutton JavaScript-->
	<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

	<!--this is a reference to the search control JavaScript-->
	<script src="https://cdn.jsdelivr.net/npm/leaflet-search@2.9.8/dist/leaflet-search.src.min.js"></script>

	<!--fullscreen #map, others borrowed from Living Campus-->
	<style type="text/css">

		body {
			padding: 0;
			margin: 0;
		}

		html, body, #map {
			height: 100%;
			width: 100%;
		}

	</style>

</head>

<body>
	
	<div id="map"></div>
	
	<!--JavaScript to build map-->
	<script type="text/javascript">

		var data = $.ajax({
			url: "corpus-test-12-19.geojson",
			dataType: "json",
			success: console.log("Data successfully loaded!"),
			error: function(xhr) {
				alert(xhr.statusText)
			}
		});

		$.when(data).done(function() {

			//initialize map
			var map = L.map("map", {scrollWheelZoom:true}).setView([39.60071, 22.29807], 5);

			//load tile layer
			L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
				attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
				subdomains: 'abcd',
				maxZoom: 18
			}).addTo(map);

			var placeLayer = L.geoJSON(data.responseJSON, {

				//set initial layer markers as not visible
				pointToLayer: function(feature, latlng) {
					var baseMarker = new L.marker(latlng, {opacity: 0});
					return baseMarker
				},

				//define popup content and event
				onEachFeature: function(feature, layer) {
					var popup = L.popup({maxHeight: 140})
						.setContent("<h1>"+feature.properties.place+"</h1><p>Pleiades ID: "+feature.properties.id+"</p><p>Person Connection: "+feature.properties.person+"</p><p>Citations: "+feature.properties.citations+"</p>");
					layer.bindPopup(popup);
				//	layer.on("mouseover", function() {
				//		this.openPopup();
				//	});
				//	layer.on("mouseout", function() {
				//		this.closePopup();
				//	});
				}

			});

			//create info popup and load to map
			var infoPopup = L.popup({maxWidth: 700}).setContent(
				"<p><b>Mythodikos: Digital Visualization of Mythical People & Places</b></p><p>The Mythodikos project, Ancient Greek for 'connected to myth', is intended to allow a student or scholar to consider mythological figures not just as they are associated with particular texts, authors, and traditions of writing, but also as they are connected to various geographical spaces.</p><hr><p>To use the Mythodikos map interface, begin typing the name of a mythical figure into the search tool.  A list of suggested reults will appear.  If your search term is not currently available in the database, a 'Name not found' message will appear.  For each search, the map will display the geographic point(s) associated with the search term.  Hover over a point to display a popup containing the place name, associated Pleiades ID number, and a list of citations supporting the person-place connection called by the search.</p><hr><p>Data for the Mythodikos project has been generated from the Perseus Digital Library Greek corpus using a text-mining tool built in Python. Geographic data and coordinates are provided by Pleiades (https://pleiades.stoa.org). The Mythodikos project has been developed by Stella Fritzell (PhD Candidate at Bryn Mawr College) in consultation with Radcliffe Edmonds, Alice McGrath, and Alicia Peaker.</p><p>Planned future work includes:<br><p><ul><li>accurate display of popup data within search results</li><li>adaptation of search tool to allow multiple results</li><li>expansion of people and places represented in dataset</li><li>eventual inclusion of Latin literature in data collection</li></ul></p>"
				);
			L.easyButton('<i class="material-icons">info_outline</i>', function(btn, map){
				infoPopup.setLatLng(map.getCenter()).openOn(map);
			}).addTo(map);

			//add search function; NEED TO DEFINE SEPECIAL MARKER TYPE WITH BOUND POPUP
			var controlSearch = new L.Control.Search({
				position: 'topleft',
				layer: placeLayer,
				propertyName: 'person',
				initial: false,
				marker: {icon: true, circle: false},
				textPlaceholder: 'Search...',
				textErr: 'Name not found'
			});

			controlSearch.on("search:locationfound", function(event) {
				event.layer.openPopup(); //automatically open popup for search result
			});

			map.addControl(controlSearch);
	
		});
		
		

	</script>

</body>

</html>
