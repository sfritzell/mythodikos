<!-- 
This is html for displaying the Mythodikos webmap
Adapted from MOLeaflet.html

NEXT STEPS:
1. update info/about popup
2. assign unique colors to each layer
3. streamline creation of filtered data layers
(4. allow citation of Greek text)
-->

<!DOCTYPE html>
<html lang="en-US">

<html>

<head>

	<title>Mythodikos</title>

	<!--the meta element disables unwanted scaling of the page when viewed on mobile devices-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<!--this is a reference to the Leaflet CSS file; CSS files must be called before JavaScript links-->
	<link
	rel="stylesheet" 
	href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
	integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
	crossorigin=""
	/>

	<!--this is a reference to the JQuery style sheet-->
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">

	<!--this is a reference to the marker cluster style sheet-->
	<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />

	<!--this is a reference to the marker cluster default style sheet-->
	<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

	<!--this is a reference to the easybutton CSS file-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">

	<!--this is a link to use google icons-->
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

	<!--this is a refence to the Leaflet JavaScript file; it must be included after the CSS-->
	<script
	src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
	integrity="ssha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
	crossorigin=""
	></script>

	<!--this is a reference to the JQuery JavaScript file-->
	<script
	src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"
	integrity="sha256-6XMVI0zB8cRzfZjqKcD01PBsAy3FlDASrlC8SxCpInY="
	crossorigin="anonymous"></script>

	<!--this is a reference to the marker cluster JavaScript file-->
	<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

	<!--this is a reference to the FeatureGroup.SubGroup plugin to work with clustering-->
	<script src="https://unpkg.com/leaflet.featuregroup.subgroup@1.0.2/dist/leaflet.featuregroup.subgroup.js"></script>

	<!--this is a reference to the easybutton JavaScript-->
	<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

	<!--CSS for fullscreen #map-->
	<style type="text/css">

		body {
			padding: 0;
			margin: 0;
		}

		html, body, #map {
			height: 100vh;
			width: 100vw;
		}

	</style>

</head>

<body>
	
	<div id="map"></div>
	
	<!--JavaScript to build map-->
	<script type="text/javascript"> //type specificaiton not necessary, JavaScript = default html script

		//load geojson file as data - consider changing geojson file to javascript file with a variable name (making it an array)
		var data = $.ajax({
			url: "corpus-test-5-2.geojson",
			dataType: "json",
			success: console.log("Data successfully loaded!"),
			error: function(xhr) {
				alert(xhr.statusText)
			}
		});

		$.when(data).done(function() {

			//initialize map
			var map = L.map("map", {scrollWheelZoom:true}).setView([39.60071, 22.29807], 5);

			//load tile layer
			L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
				attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
				subdomains: 'abcd',
				maxZoom: 18
			}).addTo(map);

			//create marker cluster group
			var mcg = markerClusterGroup().addTo(map);

			//create empty layers for filtered data, update alongside person_file
			var achillesLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var actaeonLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var adonisLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var amymoneLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var	andromedaLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var antiopeLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var arachneLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var arionLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var	ascalabusLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var asclepiusLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var atalantaLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var	bellerophonLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var busirisLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var	cadmusLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var callistoLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var cecropsLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var coronisLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var cycnusLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var cyparissusLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var cyreneLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var danaeLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var deucalionLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var diomedesLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var endymionLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var erysicthonLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var eryxLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var europaLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var euadneLayer = L.featureGroup.subGroup(mcg).addTo(map);

			var hippolytaLayer = L.featureGroup.subGroup(mcg).addTo(map);

			var meleagerLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var midasLayer = L.featureGroup.subGroup(mcg).addTo(map);

			var narcissusLayer = L.featureGroup.subGroup(mcg).addTo(map);

			var pasiphaeLayer = L.featureGroup.subGroup(mcg).addTo(map);
			var pelopsLayer = L.featureGroup.subGroup(mcg).addTo(map);


			//create base data layer and filter data
			var placeLayer = L.geoJSON(data.responseJSON, {

				//define popup content and event; TRY: BIND EVENT REPONSES TO POPUP VARIABLE
				onEachFeature: function(feature, layer) {
					var dataPopup = L.popup({maxHeight: 140})
						.setContent("<h1>"+feature.properties.place+"</h1><p>Pleiades ID: "+feature.properties.id+"</p><p>Person Connection: "+feature.properties.person+"</p><p>Citations: "+feature.properties.citations+"</p>")
					layer.bindPopup(dataPopup);

					//sort data to appropriate layers -- update with empty layers
					var figure = feature.properties.person;
					if (figure == "Achilles") layer.addTo(achillesLayer);
					else if (figure == "Actaeon") layer.addTo(actaeonLayer);
					else if (figure == "Adonis") layer.addTo(adonisLayer);
					else if (figure == "Amymone") layer.addTo(amymoneLayer);
					else if (figure == "Andromeda") layer.addTo(andromedaLayer);
					else if (figure == "Antiope") layer.addTo(antiopeLayer);
					else if (figure == "Arachne") layer.addTo(arachneLayer);
					else if (figure == "Arion") layer.addTo(arionLayer);
					else if (figure == "Ascalabus") layer.addTo(ascalabusLayer);
					else if (figure == "Asclepius") layer.addTo(asclepiusLayer);
					else if (figure == "Atalanta") layer.addTo(atalantaLayer);
					else if (figure == "Bellerophon") layer.addTo(bellerophonLayer);
					else if (figure == "Busiris") layer.addTo(busirisLayer);
					else if (figure == "Cadmus") layer.addTo(cadmusLayer);
					else if (figure == "Callisto") layer.addTo(callistoLayer);
					else if (figure == "Cecrops") layer.addTo(cecropsLayer);
					else if (figure == "Coronis") layer.addTo(coronisLayer);
					else if (figure == "Cycnus") layer.addTo(cycnusLayer);
					else if (figure == "Cyparissus") layer.addTo(cyparissusLayer);
					else if (figure == "Cyrene") layer.addTo(cyreneLayer);
					else if (figure == "Danae") layer.addTo(danaeLayer);
					else if (figure == "Deucalion") layer.addTo(deucalionLayer);
					else if (figure == "Diomedes") layer.addTo(diomedesLayer);
					else if (figure == "Endymion") layer.addTo(endymionLayer);
					else if (figure == "Erysicthon") layer.addTo(erysicthonLayer);
					else if (figure == "Eyrx") layer.addTo(eryxLayer);
					else if (figure == "Europa") layer.addTo(europaLayer);
					else if (figure == "Euadne") layer.addTo(euadneLayer);
					else if (figure == "Hippolyta") layer.addTo(hippolytaLayer);
					else if (figure == "Meleager") layer.addTo(meleagerLayer);
					else if (figure == "Midas") layer.addTo(midasLayer);
					else if (figure == "Narcissus") layer.addTo(narcissusLayer);
					else if (figure == "Pasiphae") layer.addTo(pasiphaeLayer);
					else if (figure == "Pelops") layer.addTo(pelopsLayer);

				}
			});

			//make key:value definition for layers included in layer control -- update with empty layers
			var overlayMaps = {
				"Achilles": achillesLayer,
				"Actaeon":actaeonLayer,
				"Adonis": adonisLayer,
				"Amymone": amymoneLayer,
				"Andromeda": andromedaLayer,
				"Antiope": antiopeLayer,
				"Arachne": arachneLayer,
				"Arion": arionLayer,
				"Ascalabus": ascalabusLayer,
				"Asclepius": asclepiusLayer,
				"Atalanta": atalantaLayer,
				"Bellerophon": bellerophonLayer,
				"Busiris": busirisLayer,
				"Cadmus": cadmusLayer,
				"Callisto": callistoLayer,
				"Cecrops": cecropsLayer,
				"Coronis": coronisLayer,
				"Cycnus": cycnusLayer,
				"Cyparissus": cyparissusLayer,
				"Cyrene": cyreneLayer,
				"Danae": danaeLayer,
				"Deucalion": deucalionLayer,
				"Diomedes": diomedesLayer,
				"Endymion": endymionLayer,
				"Erysicthon": erysicthonLayer,
				"Eryx": eryxLayer,
				"Europa": europaLayer,
				"Euadne": euadneLayer,
				"Hippolyta": hippolytaLayer,
				"Meleager": meleagerLayer,
				"Midas": midasLayer,
				"Narcissus": narcissusLayer,
				"Pasiphae": pasiphaeLayer,
				"Pelops": pelopsLayer
			};

			//create info popup style and contents
			var infoPopup = L.popup({width: window.innerWidth, maxHeight: 600}).setContent(
				"<p><b>Mythodikos: Digital Visualization of Mythical People & Places</b></p><p>The Mythodikos project, Ancient Greek for 'connected to myth', is intended to allow a student or scholar to consider mythological figures not just as they are associated with particular texts, authors, and traditions of writing, but also as they are connected to various geographical spaces.</p><hr><p>To use the Mythodikos map interface, begin typing the name of a mythical figure into the search tool.  A list of suggested reults will appear.  If your search term is not currently available in the database, a 'Name not found' message will appear.  For each search, the map will display the geographic point(s) associated with the search term.  Hover over a point to display a popup containing the place name, associated Pleiades ID number, and a list of citations supporting the person-place connection called by the search.</p><hr><p>Data for the Mythodikos project has been generated from the Perseus Digital Library Greek corpus using a text-mining tool built in Python. Geographic data and coordinates are provided by Pleiades (https://pleiades.stoa.org). The Mythodikos project has been developed by Stella Fritzell (PhD Candidate at Bryn Mawr College) in consultation with Radcliffe Edmonds, Alice McGrath, and Alicia Peaker.</p><p>Planned future work includes:<br><p><ul><li>accurate display of popup data within search results</li><li>adaptation of search tool to allow multiple results</li><li>expansion of people and places represented in dataset</li><li>eventual inclusion of Latin literature in data collection</li></ul></p>"
				);

			//define info popup button and load to map
			L.easyButton('<i class="material-icons">info_outline</i>', function(btn, map){
				infoPopup.setLatLng(map.getCenter()).openOn(map);
			}).addTo(map);
	
			//initialize layer contorl
			var layerControl = L.control.layers(null, overlayMaps, {position: "topleft"}).addTo(map);

		});
		
	</script>

</body>

</html>